---
import '../styles/global.css';
import { validateServerSession } from '../lib/server-session';

const sessionId = Astro.cookies.get('session-id')?.value;
let redirectUrl = '/login';

if (sessionId) {
  try {
    const user = validateServerSession(sessionId);
    if (user) {
      if (user.role === 'buyer') {
        redirectUrl = '/orders/create';
      } else if (user.role === 'supervisor') {
        redirectUrl = '/orders/tracking';
      } else if (user.role === 'procurement') {
        redirectUrl = '/orders/list';
      } else if (user.role === 'superadmin') {
        redirectUrl = '/admin/users';
      }
    }
  } catch (error) {
    console.error('Session validation failed:', error);
    redirectUrl = '/login';
  }
}

return Astro.redirect(redirectUrl);
---
